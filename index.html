<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>êµìœ¡í›ˆë ¨ ì ìˆ˜ ì¢…í•© ì‹œìŠ¤í…œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { 
            --primary: #2c3e50; --accent: #27ae60; --bg-color: #f1f3f5;
            --disabled: #e9ecef; --danger: #e74c3c; --gold: #f39c12;
            --active-row: #f0f9ff; --score-low: #ff7f50; --score-high: #2ecc71; --blue: #3498db;
        }

        html, body { margin: 0; padding: 0; width: 100%; font-family: 'Pretendard', sans-serif; background-color: var(--bg-color); color: var(--primary); display: flex; flex-direction: column; min-height: 100vh; }
        .container { width: 95%; max-width: 720px; margin: 15px auto; background: white; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.08); flex: 1; display: flex; flex-direction: column; }
        
        /* ìƒë‹¨ í—¤ë” */
        .top-header { padding: 25px 12px; border-bottom: 2px solid #f8f9fa; display: flex; flex-direction: column; align-items: center; }
        .title-area { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
        .top-logo { width: 55px; height: 55px; background-color: var(--primary); display: flex; align-items: center; justify-content: center; border-radius: 12px; color: white; font-size: 1.8rem; }
        h1 { margin: 0; font-size: 2.1rem; font-weight: 900; letter-spacing: -1.5px; color: #1a202c; }
        
        /* ê²°ê³¼ ìš”ì•½ */
        .result-summary { width: 100%; max-width: 400px; background: var(--primary); padding: 20px; border-radius: 16px; color: white; text-align: center; box-sizing: border-box; }
        .total-score { font-size: 3.8rem; font-weight: 900; color: var(--score-low); margin: 0; line-height: 1; transition: color 0.4s; }
        .progress-container { width: 100%; background: rgba(255,255,255,0.2); height: 8px; border-radius: 10px; margin-top: 15px; overflow: hidden; }
        .progress-bar { width: 0%; height: 100%; background: var(--score-low); transition: width 0.5s; }

        .content-area { padding: 20px 8px; }
        .section-title { font-size: 1.1rem; font-weight: 800; margin: 20px 0 10px 5px; display: flex; align-items: center; gap: 8px; }
        
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .table-wrapper { width: 100%; overflow-x: auto; border: 1px solid #eee; border-radius: 14px; background: #fff; }
        table { width: 100%; border-collapse: collapse; min-width: 520px; }
        th { background: #fbfbfc; padding: 15px 5px; font-size: 0.85rem; border-bottom: 2px solid #edf2f7; color: #64748b; }
        td { padding: 12px 4px; border-bottom: 1px solid #f1f5f9; text-align: center; }
        tr.active-row td { background-color: var(--active-row); }

        .score-input, .grade-select { height: 46px; padding: 0 8px; border: 2px solid #e2e8f0; border-radius: 10px; text-align: center; font-size: 0.95rem; box-sizing: border-box; }
        .score-input { width: 75px; }
        .grade-select { width: 110px; background-color: #fff; }

        .grade-badge { display: inline-block; padding: 5px 10px; border-radius: 6px; font-weight: 800; color: white; font-size: 0.8rem; background: #94a3b8; }
        .grade-íŠ¹ê¸‰ { background-color: var(--gold); }
        .grade-3ê¸‰ë¯¸ë§Œ, .grade-ë¶ˆí•©ê²© { background-color: var(--danger); }
        .grade-1ê¸‰, .grade-2ê¸‰, .grade-3ê¸‰ { background-color: #34495e; }

        .physical-calc-card { margin-top: 10px; padding: 18px; border: 2px solid var(--blue); border-radius: 16px; background-color: #f0f7ff; }
        .info-card { margin-top: 15px; padding: 18px; background: #f8fafc; border: 1px solid #e2e8f0; color: #475569; border-radius: 14px; font-size: 0.9rem; line-height: 1.7; }

        /* í•˜ë‹¨ ë²„íŠ¼ ì˜ì—­ */
        .action-area { padding: 20px 10px 40px; display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
        .btn { padding: 12px 25px; border-radius: 10px; font-weight: 700; cursor: pointer; border: none; display: flex; align-items: center; gap: 6px; font-size: 0.95rem; }
        .reset-btn { background-color: #f1f2f6; color: #7f8c8d; }
        .save-btn { background-color: var(--primary); color: white; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); transition: all 0.2s; }

        footer { text-align: center; padding: 25px; font-size: 0.85rem; color: #94a3b8; background: #f1f5f9; }

        /* [ìˆ¨ê²¨ì§„ ìš”ì†Œ] ì´ë¯¸ì§€ ì¹´ë“œ ë‚´ë³´ë‚´ê¸°ìš© ìŠ¤íƒ€ì¼ */
        #exportCard {
            position: fixed; top: 0; left: -9999px; /* í™”ë©´ ë°–ìœ¼ë¡œ ìˆ¨ê¹€ */
            width: 500px; background: white; padding: 0;
            border: 1px solid #ddd; border-radius: 0;
            font-family: 'Pretendard', sans-serif;
            z-index: 9999;
        }
        .card-header { background: var(--primary); color: white; padding: 30px 20px; text-align: center; }
        .card-body { padding: 30px; }
        .card-title { font-size: 1.8rem; font-weight: 900; margin: 0; }
        .card-date { margin-top: 10px; opacity: 0.8; font-size: 0.9rem; }
        .card-score-area { text-align: center; margin: 20px 0 30px; padding: 20px; background: #f8f9fa; border-radius: 15px; }
        .card-total { font-size: 4rem; font-weight: 900; color: var(--primary); line-height: 1; }
        .card-label { font-size: 1rem; color: #7f8c8d; margin-top: 5px; }
        .card-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .card-table th { background: #f1f2f6; color: #2c3e50; padding: 10px; text-align: center; border-bottom: 2px solid #ddd; }
        .card-table td { padding: 12px 10px; border-bottom: 1px solid #eee; text-align: center; color: #34495e; font-weight: 600; }
        .card-footer { background: #ecf0f1; color: #7f8c8d; text-align: center; padding: 15px; font-size: 0.85rem; font-weight: 700; }
    </style>
</head>
<body>

<div class="container">
    <div class="top-header">
        <div class="title-area"><div class="top-logo">ğŸ–ï¸</div><h1>êµìœ¡í›ˆë ¨ ì ìˆ˜ ì¢…í•©</h1></div>
        <div class="result-summary">
            <div style="font-size: 0.9rem; opacity: 0.8;">êµìœ¡í›ˆë ¨ í™˜ì‚° ì ìˆ˜ (70ì  ë§Œì )</div>
            <div id="totalDisplay" class="total-score">0.00</div>
            <div style="font-size: 0.85rem; opacity: 0.7;">/ 70.00 ì </div>
            <div class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
        </div>
    </div>

    <div class="content-area">
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr><th>ê³¼ëª©ëª…</th><th>ì ìˆ˜ ì…ë ¥</th><th>ë“±ê¸‰ ì„ íƒ</th><th>íŒì •</th><th>í™˜ì‚°ì ìˆ˜</th></tr>
                </thead>
                <tbody id="scoreTableBody"></tbody>
            </table>
        </div>

        <div class="section-title">ğŸƒ ê¸°ì´ˆì²´ë ¥ ì„¸ë¶€ ë“±ê¸‰ ê³„ì‚°ê¸°</div>
        <div class="physical-calc-card">
            <table style="min-width: 100%; background: transparent; border: none;">
                <tbody style="border: none;">
                    <tr style="background: transparent;">
                        <td>ë‹¬ë¦¬ê¸°</td>
                        <td><select id="runG" class="grade-select" onchange="calcPhys(true)"><option value="0">ì„ íƒ</option><option value="10">íŠ¹ê¸‰(10)</option><option value="8">1ê¸‰(8)</option><option value="6">2ê¸‰(6)</option><option value="4">3ê¸‰(4)</option><option value="0">3ê¸‰ë¯¸ë§Œ(0)</option></select></td>
                        <td>íŒ”êµ½í˜€í´ê¸°</td>
                        <td><select id="pushG" class="grade-select" onchange="calcPhys(true)"><option value="0">ì„ íƒ</option><option value="5">íŠ¹ê¸‰(5)</option><option value="4">1ê¸‰(4)</option><option value="3">2ê¸‰(3)</option><option value="2">3ê¸‰(2)</option><option value="0">3ê¸‰ë¯¸ë§Œ(0)</option></select></td>
                    </tr>
                    <tr style="background: transparent;">
                        <td>ìœ—ëª¸ì¼ìœ¼í‚¤ê¸°</td>
                        <td><select id="sitG" class="grade-select" onchange="calcPhys(true)"><option value="0">ì„ íƒ</option><option value="5">íŠ¹ê¸‰(5)</option><option value="4">1ê¸‰(4)</option><option value="3">2ê¸‰(3)</option><option value="2">3ê¸‰(2)</option><option value="0">3ê¸‰ë¯¸ë§Œ(0)</option></select></td>
                        <td colspan="2" style="text-align: right; font-weight: 800;">í•©ê³„: <span id="physSumDisplay">0</span>ì </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="info-card">
            <strong>ğŸ’¡ ìë™ ì €ì¥ ê¸°ëŠ¥</strong><br>
            â€¢ ì…ë ¥í•˜ì‹  ì ìˆ˜ëŠ” ë¸Œë¼ìš°ì €ì— <b>ìë™ìœ¼ë¡œ ì €ì¥</b>ë˜ì–´ ë‹¤ì‹œ ì ‘ì†í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤.<br>
            â€¢ ì´ˆê¸°í™”ë¥¼ ì›í•˜ì‹œë©´ í•˜ë‹¨ [ì´ˆê¸°í™”] ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
        </div>
    </div>

    <div class="action-area">
        <button class="btn reset-btn" onclick="resetAll()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
        <button class="btn save-btn" onclick="downloadImage()">ğŸ“¸ ê²°ê³¼ ì´ë¯¸ì§€ ì €ì¥</button>
    </div>
</div>

<footer>ë¬¸ì˜ : êµ­êµ°ìˆ˜ì†¡ì‚¬ë ¹ë¶€ êµìœ¡ì¥êµ</footer>

<div id="exportCard">
    <div class="card-header">
        <h2 class="card-title">ğŸ–ï¸ êµìœ¡í›ˆë ¨ í‰ê°€ ê²°ê³¼</h2>
        <div class="card-date" id="cardDate">2026. 01. 01</div>
    </div>
    <div class="card-body">
        <div class="card-score-area">
            <div class="card-label">ìµœì¢… í™˜ì‚° ì ìˆ˜</div>
            <div class="card-total" id="cardTotalScore">0.00</div>
            <div class="card-label">/ 70.00 ë§Œì </div>
        </div>
        
        <table class="card-table">
            <thead>
                <tr>
                    <th width="35%">í‰ê°€ ê³¼ëª©</th>
                    <th width="30%">íšë“ ë“±ê¸‰</th>
                    <th width="35%">í™˜ì‚° ì ìˆ˜</th>
                </tr>
            </thead>
            <tbody id="cardTableBody">
                </tbody>
        </table>
    </div>
    <div class="card-footer">
        êµ­êµ°ìˆ˜ì†¡ì‚¬ë ¹ë¶€ êµìœ¡í›ˆë ¨ ì ìˆ˜ ì¢…í•© ì‹œìŠ¤í…œ
    </div>
</div>

<script>
    // 3ê¸‰ ì ìˆ˜ ìƒí–¥ ì¡°ì • ë°˜ì˜ëœ ë°ì´í„°
    const scoreData = {
        "ì •ì‹ ì „ë ¥": { "íŠ¹ê¸‰": 10, "1ê¸‰": 9.29, "2ê¸‰": 8.58, "3ê¸‰": 7.86, "3ê¸‰ ë¯¸ë§Œ": 5.72, "ë¶ˆí•©ê²©": 4.29 },
        "ê¸°ì´ˆì²´ë ¥": { "íŠ¹ê¸‰": 10, "1ê¸‰": 9.29, "2ê¸‰": 8.58, "3ê¸‰": 7.86, "3ê¸‰ ë¯¸ë§Œ": 5.72, "ë¶ˆí•©ê²©": 4.29 },
        "ì‚¬ê²©": { "íŠ¹ê¸‰": 10, "1ê¸‰": 9.29, "2ê¸‰": 8.58, "3ê¸‰": 7.86, "3ê¸‰ ë¯¸ë§Œ": 5.72, "ë¶ˆí•©ê²©": 4.29 },
        "í•µ ë° í™”ìƒë°©": { "íŠ¹ê¸‰": 5, "1ê¸‰": 4.65, "2ê¸‰": 4.29, "3ê¸‰": 3.93, "3ê¸‰ ë¯¸ë§Œ": 2.56, "ë¶ˆí•©ê²©": 2.15 },
        "TCCC": { "íŠ¹ê¸‰": 5, "1ê¸‰": 4.65, "2ê¸‰": 4.29, "3ê¸‰": 3.93, "3ê¸‰ ë¯¸ë§Œ": 2.56, "ë¶ˆí•©ê²©": 2.15 },
        "ì£¼íŠ¹ê¸°": { "íŠ¹ê¸‰": 30, "1ê¸‰": 27.86, "2ê¸‰": 25.72, "3ê¸‰": 23.58, "3ê¸‰ ë¯¸ë§Œ": 17.15, "ë¶ˆí•©ê²©": 12.86 }
    };

    const subjects = Object.keys(scoreData);

    function init() {
        const tbody = document.getElementById('scoreTableBody');
        tbody.innerHTML = '';
        subjects.forEach((sub, idx) => {
            const isPhys = sub === "ê¸°ì´ˆì²´ë ¥";
            const row = document.createElement('tr');
            row.id = `row_${idx}`;
            row.innerHTML = `
                <td><b>${sub}</b></td>
                <td>${isPhys ? `<span style="font-size:0.8rem; color:var(--blue)">í•˜ë‹¨ ê³„ì‚°ê¸° ì´ìš©</span>` : `<input type="number" class="score-input" id="input_${idx}" oninput="handleInput(${idx}, true)" placeholder="${sub==='ì‚¬ê²©'?'0-20':'0-100'}">`}</td>
                <td><select class="grade-select" id="select_${idx}" onchange="handleSelect(${idx}, true)" ${isPhys ? 'disabled' : ''}><option value="">ì„ íƒ</option><option value="íŠ¹ê¸‰">íŠ¹ê¸‰</option><option value="1ê¸‰">1ê¸‰</option><option value="2ê¸‰">2ê¸‰</option><option value="3ê¸‰">3ê¸‰</option><option value="3ê¸‰ ë¯¸ë§Œ">3ê¸‰ ë¯¸ë§Œ</option><option value="ë¶ˆí•©ê²©">ë¶ˆí•©ê²©</option></select></td>
                <td><span id="grade_${idx}" class="grade-badge">-</span></td>
                <td><span id="point_${idx}" class="display-point">0.00</span></td>
            `;
            tbody.appendChild(row);
        });
        
        // ë°ì´í„° ë¡œë“œ
        loadFromStorage();
    }

    // --- ê³„ì‚° ë¡œì§ ---

    function calcPhys(save = false) {
        const r = document.getElementById('runG').value;
        const p = document.getElementById('pushG').value;
        const s = document.getElementById('sitG').value;
        
        const sum = parseInt(r) + parseInt(p) + parseInt(s);
        document.getElementById('physSumDisplay').innerText = sum;
        
        let grade = "ë¶ˆí•©ê²©";
        if (sum >= 20) grade = "íŠ¹ê¸‰";
        else if (sum >= 16) grade = "1ê¸‰";
        else if (sum >= 12) grade = "2ê¸‰";
        else if (sum >= 8) grade = "3ê¸‰";
        else if (sum >= 1) grade = "3ê¸‰ ë¯¸ë§Œ";
        
        applyResult(1, grade);
        const sel = document.getElementById('select_1');
        sel.value = grade;

        if(save) saveToStorage();
    }

    function handleInput(idx, save = false) {
        const inputEl = document.getElementById(`input_${idx}`);
        const selectEl = document.getElementById(`select_${idx}`);
        const val = parseFloat(inputEl.value);
        if (isNaN(val)) { 
            selectEl.disabled = false; 
            applyResult(idx, ""); 
        } else {
            selectEl.disabled = true;
            let grade = "ë¶ˆí•©ê²©";
            if (subjects[idx] === "ì‚¬ê²©") {
                if (val >= 18) grade = "íŠ¹ê¸‰"; else if (val >= 16) grade = "1ê¸‰"; else if (val >= 14) grade = "2ê¸‰"; else if (val >= 12) grade = "3ê¸‰"; else if (val >= 1) grade = "3ê¸‰ ë¯¸ë§Œ";
            } else {
                if (val >= 90) grade = "íŠ¹ê¸‰"; else if (val >= 80) grade = "1ê¸‰"; else if (val >= 70) grade = "2ê¸‰"; else if (val >= 60) grade = "3ê¸‰"; else if (val > 0) grade = "3ê¸‰ ë¯¸ë§Œ";
            }
            applyResult(idx, grade);
        }
        if(save) saveToStorage();
    }

    function handleSelect(idx, save = false) {
        const inputEl = document.getElementById(`input_${idx}`);
        const selectEl = document.getElementById(`select_${idx}`);
        if (selectEl.value !== "") { 
            if(inputEl) inputEl.disabled = true; 
            applyResult(idx, selectEl.value); 
        } else { 
            if(inputEl) inputEl.disabled = false; 
            applyResult(idx, ""); 
        }
        if(save) saveToStorage();
    }

    function applyResult(idx, grade) {
        const point = grade ? scoreData[subjects[idx]][grade] : 0;
        const gradeEl = document.getElementById(`grade_${idx}`);
        const pointEl = document.getElementById(`point_${idx}`);
        
        gradeEl.innerText = grade || "-";
        gradeEl.className = `grade-badge ${grade ? 'grade-' + grade.replace(" ", "") : ""}`;
        pointEl.innerText = point.toFixed(2);
        
        const row = document.getElementById(`row_${idx}`);
        if(grade) row.classList.add('active-row'); else row.classList.remove('active-row');
        calculateTotal();
    }

    function calculateTotal() {
        let total = 0;
        document.querySelectorAll('.display-point').forEach(p => { total += parseFloat(p.innerText); });
        
        const disp = document.getElementById('totalDisplay');
        disp.innerText = total.toFixed(2);
        
        const color = total >= 60 ? "#2ecc71" : "#ff7f50";
        disp.style.color = color;
        document.getElementById('progressBar').style.width = Math.min((total / 70 * 100), 100) + "%";
        document.getElementById('progressBar').style.background = color;
    }

    // --- 1. ìë™ ì €ì¥ ê¸°ëŠ¥ (LocalStorage) ---
    
    function saveToStorage() {
        const data = {
            inputs: [],
            selects: [],
            phys: {
                run: document.getElementById('runG').value,
                push: document.getElementById('pushG').value,
                sit: document.getElementById('sitG').value
            }
        };

        subjects.forEach((_, idx) => {
            const input = document.getElementById(`input_${idx}`);
            const select = document.getElementById(`select_${idx}`);
            data.inputs.push(input ? input.value : "");
            data.selects.push(select ? select.value : "");
        });

        localStorage.setItem('militaryScoreData', JSON.stringify(data));
    }

    function loadFromStorage() {
        const saved = localStorage.getItem('militaryScoreData');
        if (!saved) return;

        const data = JSON.parse(saved);
        
        // ì²´ë ¥ ë°ì´í„° ë³µêµ¬
        if(data.phys) {
            document.getElementById('runG').value = data.phys.run;
            document.getElementById('pushG').value = data.phys.push;
            document.getElementById('sitG').value = data.phys.sit;
            calcPhys(false); // UI ì—…ë°ì´íŠ¸ (ì €ì¥ X)
        }

        // ê° ê³¼ëª© ë°ì´í„° ë³µêµ¬
        subjects.forEach((_, idx) => {
            const input = document.getElementById(`input_${idx}`);
            const select = document.getElementById(`select_${idx}`);
            
            if (input && data.inputs[idx]) {
                input.value = data.inputs[idx];
                handleInput(idx, false);
            } else if (select && data.selects[idx]) {
                select.value = data.selects[idx];
                handleSelect(idx, false);
            }
        });
    }

    function resetAll() {
        if(confirm("ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.removeItem('militaryScoreData');
            location.reload();
        }
    }

    // --- 2. ì´ë¯¸ì§€ ì¹´ë“œ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ (html2canvas) ---

    function downloadImage() {
        // 1. ì¹´ë“œ ë°ì´í„° ìµœì‹ í™”
        const today = new Date();
        document.getElementById('cardDate').innerText = `${today.getFullYear()}. ${today.getMonth()+1}. ${today.getDate()}`;
        document.getElementById('cardTotalScore').innerText = document.getElementById('totalDisplay').innerText;
        
        const tbody = document.getElementById('cardTableBody');
        tbody.innerHTML = '';
        
        subjects.forEach((sub, idx) => {
            const grade = document.getElementById(`grade_${idx}`).innerText;
            const point = document.getElementById(`point_${idx}`).innerText;
            if(grade !== "-") {
                tbody.innerHTML += `
                    <tr>
                        <td>${sub}</td>
                        <td style="color:var(--primary)">${grade}</td>
                        <td>${point}</td>
                    </tr>
                `;
            }
        });

        if(tbody.innerHTML === '') {
            alert("ì €ì¥í•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì ìˆ˜ë¥¼ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.");
            return;
        }

        // 2. ì´ë¯¸ì§€ ìº¡ì²˜ ë° ë‹¤ìš´ë¡œë“œ
        const card = document.getElementById('exportCard');
        // ìº¡ì²˜ë¥¼ ìœ„í•´ ì ì‹œ ìœ„ì¹˜ ì¡°ì • (í™”ë©´ ë°– -> í™”ë©´ ì•ˆ, íˆ¬ëª…ë„ ì¡°ì ˆ ì—†ì´)
        // html2canvasëŠ” display:none ìš”ì†Œë¥¼ ìº¡ì²˜ ëª»í•˜ë¯€ë¡œ fixedë¡œ í™”ë©´ ë°– ì²˜ë¦¬ ìœ ì§€

        html2canvas(card, { scale: 2 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `êµìœ¡í›ˆë ¨í‰ê°€_${today.toISOString().slice(0,10)}.png`;
            link.href = canvas.toDataURL();
            link.click();
        }).catch(err => {
            alert("ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            console.error(err);
        });
    }

    window.onload = init;
</script>
</body>
</html>
